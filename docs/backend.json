{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CV Match Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "JobPositionTemplate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JobPositionTemplate",
      "type": "object",
      "description": "Represents a job position template (card) created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the JobPositionTemplate entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N JobPositionTemplate)"
        },
        "description": {
          "type": "string",
          "description": "Description of the job position."
        }
      },
      "required": [
        "id",
        "userId",
        "description"
      ]
    },
    "Cv": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Cv",
      "type": "object",
      "description": "Represents a CV uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Cv entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Cv)"
        },
        "fileName": {
          "type": "string",
          "description": "Name of the uploaded CV file."
        },
        "fileType": {
          "type": "string",
          "description": "Type of the uploaded CV file (e.g., PDF, Word)."
        },
        "fileData": {
          "type": "string",
          "description": "The binary data of the CV file.  Consider storing this in object storage and only referencing it here."
        }
      },
      "required": [
        "id",
        "userId",
        "fileName",
        "fileType",
        "fileData"
      ]
    },
    "AnalysisResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AnalysisResult",
      "type": "object",
      "description": "Represents the result of analyzing a CV against a job position template.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AnalysisResult entity."
        },
        "jobPositionTemplateId": {
          "type": "string",
          "description": "Reference to JobPositionTemplate. (Relationship: JobPositionTemplate 1:N AnalysisResult)"
        },
        "cvId": {
          "type": "string",
          "description": "Reference to Cv. (Relationship: Cv 1:N AnalysisResult)"
        },
        "matchPercentage": {
          "type": "number",
          "description": "Percentage match score between the CV and the job position template."
        }
      },
      "required": [
        "id",
        "jobPositionTemplateId",
        "cvId",
        "matchPercentage"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Documents are only accessible by the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/jobPositionTemplates/{jobPositionTemplateId}",
        "definition": {
          "entityName": "JobPositionTemplate",
          "schema": {
            "$ref": "#/backend/entities/JobPositionTemplate"
          },
          "description": "Stores job position templates (cards) created by users. Only accessible by the creating user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "jobPositionTemplateId",
              "description": "The unique identifier of the job position template."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cvs/{cvId}",
        "definition": {
          "entityName": "Cv",
          "schema": {
            "$ref": "#/backend/entities/Cv"
          },
          "description": "Stores CVs uploaded by users.  Only accessible by the uploading user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "cvId",
              "description": "The unique identifier of the CV."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/analysisResults/{analysisResultId}",
        "definition": {
          "entityName": "AnalysisResult",
          "schema": {
            "$ref": "#/backend/entities/AnalysisResult"
          },
          "description": "Stores the results of analyzing CVs against job position templates. Only accessible by the user who owns both the CV and JobPositionTemplate.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "analysisResultId",
              "description": "The unique identifier of the analysis result."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure, scalable, and easily maintainable backend for the CV Match Pro application. The core principle is to ensure Authorization Independence by denormalizing relevant authorization data, avoiding hierarchical `get()` calls in security rules. This structure is optimized for robustness, clarity, and debuggability.\n\n**Authorization Independence:** User ownership is enforced through path-based rules (`/users/{userId}`). For collaborative data, such as if job position templates were shared, a membership map (`members: {uid: role}`) would be denormalized into each document to avoid `get()` calls in security rules. This ensures atomic operations and simplifies debugging.\n\n**Structural Segregation:**  Each collection is designed to have a homogeneous security posture. User-specific data (CVs, JobPositionTemplates, AnalysisResults) are stored under their respective user IDs, ensuring only the user has access. This simplifies rules and avoids mixing data with differing access requirements in the same collection.\n\n**Access Modeling:** Private data is modeled using path-based ownership. User data is stored under `/users/{userId}`.  The 1:N relationships between User and other entities (JobPositionTemplate, Cv, AnalysisResult) are maintained by nesting data under the user's path. Collaborative features (if implemented) would use membership maps.\n\n**QAPs (Rules are not Filters):** The structure supports secure `list` operations by ensuring that list operations are always performed on collections where the user has the appropriate access.  For example, a user can only list their own JobPositionTemplates, CVs, and AnalysisResults, as these are stored under their user ID."
  }
}